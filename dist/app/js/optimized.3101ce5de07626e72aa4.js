!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){var b="waitForImages";a.waitForImages={hasImageProperties:["backgroundImage","listStyleImage","borderImage","borderCornerImage","cursor"],hasImageAttributes:["srcset"]},a.expr[":"]["has-src"]=function(b){return a(b).is('img[src][src!=""]')},a.expr[":"].uncached=function(b){return!!a(b).is(":has-src")&&!b.complete},a.fn.waitForImages=function(){var c,d,e,f=0,g=0,h=a.Deferred();if(a.isPlainObject(arguments[0])?(e=arguments[0].waitForAll,d=arguments[0].each,c=arguments[0].finished):1===arguments.length&&"boolean"===a.type(arguments[0])?e=arguments[0]:(c=arguments[0],d=arguments[1],e=arguments[2]),c=c||a.noop,d=d||a.noop,e=!!e,!a.isFunction(c)||!a.isFunction(d))throw new TypeError("An invalid callback was supplied.");return this.each(function(){var i=a(this),j=[],k=a.waitForImages.hasImageProperties||[],l=a.waitForImages.hasImageAttributes||[],m=/url\(\s*(['"]?)(.*?)\1\s*\)/g;e?i.find("*").addBack().each(function(){var b=a(this);b.is("img:has-src")&&j.push({src:b.attr("src"),element:b[0]}),a.each(k,function(a,c){var d,e=b.css(c);if(!e)return!0;for(;d=m.exec(e);)j.push({src:d[2],element:b[0]})}),a.each(l,function(c,d){var e,f=b.attr(d);return!f||(e=f.split(","),void a.each(e,function(c,d){d=a.trim(d).split(" ")[0],j.push({src:d,element:b[0]})}))})}):i.find("img:has-src").each(function(){j.push({src:this.src,element:this})}),f=j.length,g=0,0===f&&(c.call(i[0]),h.resolveWith(i[0])),a.each(j,function(e,j){var k=new Image,l="load."+b+" error."+b;a(k).one(l,function b(e){var k=[g,f,"load"==e.type];return g++,d.apply(j.element,k),h.notifyWith(j.element,k),a(this).off(l,b),g==f?(c.call(i[0]),h.resolveWith(i[0]),!1):void 0}),k.src=j.src})}),h.promise()}}),function(){function a(a){if(history&&history.replaceState){var b=SiteUtils.removeURLParameter(location.href,"code");b=SiteUtils.removeURLParameter(b,"state");var c=window.location.hash.replace("#","");b=b.replace("?#"+c,"").replace("#"+c,""),b+="#"+a,window.history.replaceState({path:b},"",b)}}function b(a){console.log("statusChangeCallback"),console.log(a),"connected"===a.status?console.log("connected"):"not_authorized"===a.status?console.log("not authorized"):console.log("not login")}function c(a){for(var b=atob(a.split(",")[1]),c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([c],{type:"image/png"})}var d=window.FBHelper={_appId:null,_uid:null,_uname:null,_token:null,settings:{useRedirectLogin:!1,permissions:[]},init:function(a,c,e,f,g){var h={appId:a,cookie:!0,xfbml:!0,status:!1,version:"v2.8"};$.extend(d.settings,c),d._appId=h.appId,window.fbAsyncInit=function(){FB.init(h),g&&FB.getLoginStatus(function(a){b(a)}),e&&e.apply()},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/zh_TW/sdk.js?v=1",e.parentNode.insertBefore(d,e),d.onerror=f)}(document,"script","facebook-jssdk")},checkAccessToken:function(){if(location.hash.match("access_token")&&location.hash.match("state")){var b=location.hash.replace("#","?");if(b){d._token=SiteUtils.getParameterByName("access_token",b);var c=SiteUtils.getParameterByName("state",b);window.location.hash="#"+c,a(c)}}},loginFB:function(a,b,c){function e(){Loading&&Loading.hide();var c=b?encodeURI(redirectUrl):encodeURI(window.location.href.replace(window.location.search,"").replace(window.location.hash,"").replace("?","")),e="https://www.facebook.com/dialog/oauth?response_type=token&client_id="+Main.settings.fb_appid+"&scope="+d.settings.permissions.join(",")+"&state="+a+"&redirect_uri="+c;window.open(e,"_self")}function f(a,b){a&&(d._token=a.accessToken,d._uid=a.userID),c&&c.call(null,b)}d._uid?f():d.settings.useRedirectLogin?FB.getLoginStatus(function(a){"connected"===a.status?f(a.authResponse):e()}):FB.login(function(a){a.error?f(null,"登入 Facebook 失敗"):a.authResponse?f(a.authResponse):f(null,"unauthorized")},{scope:Main.settings.fbPermissions,return_scopes:!0,auth_type:"rerequest"})},getPublicProfile:function(a){FB.api("/me",function(b){d._uname=b.name,a.apply(null,[b])})},checkLoginStatus:function(a,b){function c(c){for(var d={},e=a.length,f=0,g=0;g<a.length;g++)d[a[g]]=!1;FB.api("/me/permissions",function(a){if(a&&a.data&&a.data.length){var g,h;for(g=0;g<a.data.length;g++)h=a.data[g],void 0!==d[h.permission]&&(d[h.permission]=!0,f++);f<e?b.call(null,{message:"lack permission",permissionDic:d},null):b.call(null,null,c)}else b.call(null,{message:"check permission fail"},null)})}FB.getLoginStatus(function(d){"connected"===d.status?a?c(d.authResponse):b.call(null,null,d.authResponse):b.call(null,{message:"no connect"},null)})},postCanvasToFacebook:function(a,b,d){var e,f=a.toDataURL("image/png");try{e=c(f)}catch(a){console.log(a)}var g=new FormData;g.append("access_token",b),g.append("source",e);try{$.ajax({url:"https://graph.facebook.com/me/photos?access_token="+b,type:"POST",data:g,processData:!1,contentType:!1,cache:!1,success:function(a){d.call(null,null,a)},error:function(a,b,c){d.call(null,"error "+c+" Status "+a.status)},complete:function(){}})}catch(a){d.call(null,a)}}}}(),function(){function a(a,b,c){this.api=a,this.apiParams=b,this.after=null,this.dataList=[],this.thereIsMore=!0,this.cbFetchComplete=c,this.lastFetchIndex=0}window.FBData=a,a.prototype.fetch=function(){var a=this;return a.thereIsMore||(console.log("warning: trying to fetch data where there is no more."),a.cbFetchComplete.call(a,a.dataList)),a.lastFetchIndex=a.dataList.length,FB.api(a.api,"GET",a.apiParams,function(b){b.error?console.error(b.error):(a.dataList=a.dataList.concat(b.data),a.apiParams.after=Boolean(b.paging&&b.paging.next)?b.paging.cursors.after:null,a.apiParams.after?a.thereIsMore=!0:(delete a.apiParams.after,a.thereIsMore=!1),a.cbFetchComplete.call(a,a.dataList))}),this}}(),function(){"use strict";function a(a){var b=parseInt(a);return isNaN(b)&&(b=0),b}var b=window.Helper={};b.getSize_cover=function(a,b,c,d){var e,f,g=a/b,h=c/d;h>g?(f=b,e=f*h):(e=a,f=e/h);var i=e/c,j=a/i,k=b/i;return{width:e,height:f,ratio:i,contentCenterBound:{x:.5*(c-j),y:.5*(d-k),width:j,height:k}}},b.getSize_contain=function(a,b,c,d){var e,f,g=a/b,h=c/d;return h>g?(e=a,f=e/h):(f=b,e=f*h),{width:e,height:f,ratio:e/c}},Helper.extract=function(a,b,c,d){null==d&&(d=0),null==b&&(b=document);var e=$(b).find(a).get(d);return e||console.error("can't find dom, selector: "+a+", source: "+b),Helper.getInitValue(e),null!=c&&c.appendChild(e),e},Helper.$extract=function(a,b,c,d){null==d&&(d=0),null==b&&(b=document);var e=$(b).find(a).get(d);return e||console.error("can't find dom, selector: "+a+", source: "+b),Helper.getInitValue(e),null!=c&&c.appendChild(e),$(e)},Helper.pxToPercent=function(b,c,d,e,f){function g(b,c,d){null==d&&(d=100);var e=Helper.styleDic[b];e||(e=b);var g=a(i.css(e)),h=g/c*d+"%";f?f[b]=h:0!=g&&i.css(e,h)}e||(e={w:!0,h:!1,l:!0,t:!1,r:!0,b:!1});var h,i=$(b);for(h in e){g(h,1==e[h]?c:d)}},Helper.clearStyles=function(a){$(a).removeAttr("style")},Helper.getInitValue=function(b,c,d,e,f,g){b.init||(b.init={}),b.geom||(b.geom={}),f&&Helper.clearStyles(b);var h,i;if(g?(h=b.init[g]={},i=b.geom[g]={}):(h=b.init,i=b.geom),c||(b.currentStyle?(i.w=h.w=a(b.currentStyle.width),i.h=h.h=a(b.currentStyle.height),i.ml=h.ml=a(b.currentStyle.marginLeft),i.mt=h.mt=a(b.currentStyle.marginTop),i.mr=h.mr=a(b.currentStyle.marginRight),i.mb=h.mb=a(b.currentStyle.marginBottom),i.t=h.t=a(b.currentStyle.top),i.l=h.l=a(b.currentStyle.left),i.r=h.r=a(b.currentStyle.right),i.b=h.b=a(b.currentStyle.bottom)):(i.w=h.w=$(b).width(),i.h=h.h=$(b).height(),i.ml=h.ml=a($(b).css("margin-left")),i.mt=h.mt=a($(b).css("margin-top")),i.mr=h.mr=a($(b).css("margin-right")),i.mb=h.mb=a($(b).css("margin-bottom")),i.t=h.t=a($(b).css("top")),i.l=h.l=a($(b).css("left")),i.r=h.r=a($(b).css("right")),i.b=h.b=a($(b).css("bottom")))),i.scale=h.scale=1,d)for(var j=0;j<d.length;j++){var k=d[j];h[k]=i[k]=a($(b).css(k))}if(e){var l,m,n;l=e.width,m=e.height,n=e.styleDic,Helper.pxToPercent(b,l,m,n,h)}},Helper.styleDic={l:"left",r:"right",t:"top",b:"bottom",ml:"margin-left",mr:"margin-right",mt:"margin-top",mb:"margin-bottom",w:"width",h:"height"},Helper.applyTransform=function(a,b,c,d,e,f){var g,h;f?(g=a.init[f],h=a.geom[f]):(g=a.init,h=a.geom);var i,j,k,l,m=null!=b?g.scale*b:g.scale,n=$(a);if(c)for(j=c.length,i=0;i<j;i++)k=c[i],l=Helper.styleDic[k],l||(l=k),h[k]=g[k]*m,n.css(l,h[k]+"px");if(d)for(j=d.length,i=0;i<j;i++)k=d[i],l=Helper.styleDic[k],h[k]=g[k]*m,n.css(l,h[k]+"%");if(e)for(j=e.length,i=0;i<j;i++)k=e[i],l=Helper.styleDic[k],l||(l=k),n.css(l,g[k])},Helper.transformDom=function(a,b,c,d,e){var f=null!=b?a.init.scale*b:a.init.scale;0!=e&&(!0===e?(a.geom.w=a.init.w*f,a.geom.h=a.init.h*f,$(a).css("width",a.geom.w).css("height",a.geom.h)):(c.l&&(a.geom.l=a.init.l*f,$(a).css("left",a.geom.l)),c.t&&(a.geom.t=a.init.t*f,$(a).css("top",a.geom.t)))),0!=c&&(!0===c?(a.geom.t=a.init.t*f,a.geom.l=a.init.l*f,$(a).css("top",a.geom.t).css("left",a.geom.l)):(c.l&&(a.geom.l=a.init.l*f,$(a).css("left",a.geom.l)),c.t&&(a.geom.t=a.init.t*f,$(a).css("top",a.geom.t)),c.r&&(a.geom.r=a.init.r*f,$(a).css("right",a.geom.r)),c.b&&(a.geom.b=a.init.b*f,$(a).css("bottom",a.geom.b)))),0!=d&&(!0===d?(a.geom.mt=a.init.mt*f,a.geom.ml=a.init.ml*f,$(a).css("margin-top",a.geom.mt).css("margin-left",a.geom.ml)):(c.ml&&(a.geom.ml=a.init.ml*f,$(a).css("margin-left",a.geom.ml)),c.mt&&(a.geom.mt=a.init.mt*f,$(a).css("margin-top",a.geom.mt)),c.mr&&(a.geom.mr=a.init.mr*f,$(a).css("margin-right",a.geom.mr)),c.mb&&(a.geom.mb=a.init.mb*f,$(a).css("margin-bottom",a.geom.mb))))},Helper.downScaleImage=function(a,b,c,d,e,f){var g=document.createElement("canvas");return g.width=a.width,g.height=a.height,g.getContext("2d").drawImage(a,0,0),Helper.downScaleCanvas(g,b,c,d,e,f)},Helper.downScaleCanvas=function(a,b,c,d,e,f){if(c||(c=0),d||(d=0),!(b<1&&b>0))throw"scale must be a positive number <1 ";var g=b*b,h=a.width,i=a.height,j=Math.floor(h*b),k=Math.floor(i*b),l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=!1,B=!1,C=a.getContext("2d").getImageData(0,0,h,i).data,D=new Float32Array(3*j*k),E=0,F=0,G=0;for(m=0;m<i;m++)for(p=m*b,t=0|p,q=3*t*j,B=t!=(0|p+b),B&&(y=t+1-p,z=p+b-t-1),l=0;l<h;l++,n+=4)o=l*b,s=0|o,r=q+3*s,A=s!=(0|o+b),A&&(w=s+1-o,x=o+b-s-1),E=C[n],F=C[n+1],G=C[n+2],A||B?A&&!B?(u=w*b,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=x*b,D[r+3]+=E*v,D[r+4]+=F*v,D[r+5]+=G*v):B&&!A?(u=y*b,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=z*b,D[r+3*j]+=E*v,D[r+3*j+1]+=F*v,D[r+3*j+2]+=G*v):(u=w*y,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=x*y,D[r+3]+=E*v,D[r+4]+=F*v,D[r+5]+=G*v,v=w*z,D[r+3*j]+=E*v,D[r+3*j+1]+=F*v,D[r+3*j+2]+=G*v,v=x*z,D[r+3*j+3]+=E*v,D[r+3*j+4]+=F*v,D[r+3*j+5]+=G*v):(D[r]+=E*g,D[r+1]+=F*g,D[r+2]+=G*g);var H=document.createElement("canvas");H.width=e||j,H.height=f||k;var I=H.getContext("2d"),J=I.getImageData(0,0,j,k),K=J.data,L=0;for(n=0,r=0;L<j*k;n+=3,r+=4,L++)K[r]=Math.ceil(D[n]),K[r+1]=Math.ceil(D[n+1]),K[r+2]=Math.ceil(D[n+2]),K[r+3]=255;return I.putImageData(J,c,d),H},Helper.imageToCanvas=function(a,b,c){var d=document.createElement("canvas"),e=1,f=b,g=c;d.width=f,d.height=g;var h=d.getContext("2d"),i=Helper.getSize_cover(f,g,a.width,a.height),j=.5*(f-i.width),k=.5*(g-i.height);return i.ratio<1?($(d).detach(),d=Helper.downScaleImage(a,i.ratio,j,k,f,g)):h.drawImage(a,0,0,a.width,a.height,j,k,i.width*e,i.height),d},Helper.getContextBoundingBox=function(a,b){void 0===b&&(b=15);var c,d,e,f,g,h,i=a.canvas.width,j=a.canvas.height,k=a.getImageData(0,0,i,j).data;a:for(d=j;d--;)for(c=i;c--;)if(k[4*(i*d+c)+3]>b){h=d;break a}if(h){a:for(c=i;c--;)for(d=h+1;d--;)if(k[4*(i*d+c)+3]>b){g=c;break a}a:for(c=0;c<=g;++c)for(d=h+1;d--;)if(k[4*(i*d+c)+3]>b){e=c;break a}a:for(d=0;d<=h;++d)for(c=e;c<=g;++c)if(k[4*(i*d+c)+3]>b){f=d;break a}return{x:e,y:f,maxX:g,maxY:h,w:g-e,h:h-f}}},Helper.precentPullToRefresh=function(){var a=function(a){function b(b){a=b.touches[0].clientY}function c(b){var c=b.touches[0].clientY,d=c-a;return a=c,d>0}a=a||0;var d=!1;return{touchstartHandler:function(a){1==a.touches.length&&(b(a),d=0===window.pageYOffset)},touchmoveHandler:function(a){if(d&&(d=!1,c(a)))return void a.preventDefault()}}}();document.addEventListener("touchstart",a.touchstartHandler),document.addEventListener("touchmove",a.touchmoveHandler)},Helper.changeQueryParam=function(a,b,c){var d=new RegExp("([?&])"+b+"=.*?(&|$)","i"),e=-1!==a.indexOf("?")?"&":"?";return a.match(d)?a.replace(d,"$1"+b+"="+c+"$2"):a+e+b+"="+c},Helper.removeURLParameter=function(a,b){var c=a.split("?");if(c.length>=2){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;f-- >0;)-1!==e[f].lastIndexOf(d,0)&&e.splice(f,1);return a=c[0]+(e.length>0?"?"+e.join("&"):"")}return a},Helper.getParameterByName=function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},Helper.selectIntoArray=function(a,b,c,d){function e(b){var e=a.find(b);return e.length>0&&c.push(e[0]),d&&(d[b]=e),e}if(b.constructor!==Array)return e(b);for(var f=0;f<b.length;f++)e(b[f])},Helper.clearElementsStyles=function(a,b){if(b){var c;for(c=0;c<b.length;c++)a.css(b[c],"")}else a.attr("style","")}}(),function(){function a(a){return i&&(a=i.call(null,a)),a}function b(a){a||(a=s),u&&l.getHash()!=a?l.setHash(a):l.toContent(a)}function c(){n=!1,null!=q&&(q.apply(),q=null),f&&f.apply()}var d,e,f,g,h,i,j,k,l=window.SceneHandler={},m={},n=!1,o=null,p=null,q=null,r=null,s="/Index",t=!1,u=!0,v={},w={},x=null;l.currentScene=null,l.processHashNames=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];_contentClasses.push(window[d]),b.push("/"+d)}return b},l.getLastHash=function(){return p},l.init=function(b,c){c=c||{},d=c.version||"0",e=c.cbBeforeChange,f=c.cbAfterChange,i=c.hashChangeTester,g=c.cbContentChange,r=c.cbContentLoaded,h=c.cbBeforeStageIn,k=c.loadingClass,s=c.defaultHash||"/Index",u=void 0===c.listeningHashChange||c.listeningHashChange;var j,o,p;if(c.blockHashs)for(j=0;j<c.blockHashs.length;j++)w[c.blockHashs[j]]=!0;var t,v,x;for(j=0;j<b.length;j++){if(o=b[j],t=o.split("/"),v=t[1],x=null,2==t.length);else{if(3!=t.length){console.error("illegal hash: "+o);continue}x="/"+t[2]}window[v]?(p={hash:o,index:j,stageClass:window[v],contentHash:x},m[o]=p):console.error("class for: "+v+" is not exist")}u&&l.onHashChange(function(b){""==b&&(b=s),(b=a(b))&&m[b]&&!w[b]&&(n?q=function(){l.toContent(b)}:l.toContent(b))})},l.setLock=function(a){t=a},l.onHashChange=function(a){function b(){t||(j?j=!1:a.apply(null,[l.getHash()]))}if("onhashchange"in window)window.onhashchange=function(){b()};else{var c=window.location.hash;window.setInterval(function(){window.location.hash!=c&&(c=window.location.hash,b())},100)}},l.toLastHash=function(){l.toHash(p)},l.toLastNonPopupHash=function(){l.toHash(x)},l.getHash=function(){return window.location.hash.replace("#","")},l.setHash=function(a,b){b&&(j=!0),window.location.hash="#"+a},l.toFirstHash=function(b){var c=l.getHash();if(u&&m[c]&&!w[c]||(c=s),c=a(c)){if(m[c].stageClass._isPopup){var d=c;q=function(){l.toContent(d)},c=s}return l.toContent(c,b),c}},l.toHash=function(a){w[a]?l.toContent(a):b(a)},l.toContent=function(a,b){if(!n&&(""==a&&(a=s),o!=a)){var d,f;if(b||(b={}),b.firstIn=!1,b.cbContentLoaded=r,n=!0,g&&g.call(null,a),b.lastHash=o,null==o)b.isFirstIn=!0,p=o,o=a,d=m[a],b.contentHash=d.contentHash,l.currentScene=d.stageClass,l.currentScene._isPopup||(x=o),h&&h.call(null,o,p),d.stageClass.stageIn(b,c);else if(m[o]&&m[a])if(e&&e.apply(),f=m[o],d=m[a],p=o,o=a,f.stageClass===d.stageClass&&d.contentHash!==f.contentHash)f.stageClass.toContent(d.contentHash,function(){c()});else{l.currentScene=d.stageClass;var i=f.stageClass,j=d.stageClass,k=x;b.contentHash=d.contentHash,l.currentScene._isPopup||(x=o),1!=i._isPopup||j._isPopup?i._isPopup||1!=j._isPopup?1==i._isPopup&&1==j._isPopup?(i.hide(),j.show(c)):f.stageClass.stageOut(b,function(){h&&h.call(null,o,p),d.stageClass.stageIn(b,c)}):j.show(c):k&&k!==o?(i.hide(),m[k].stageClass.stageOut(b,function(){h&&h.call(null,o,p),d.stageClass.stageIn(b,c)})):i.hide(function(){j.executeAfterPopupClosed&&j.executeAfterPopupClosed.call(),c()})}}},l.loadTemplate=function(a,b,c,e,f){function g(a){function j(){a++,a>=b.length?(!k||f||e||k.hide(),c.apply(null)):g(a)}if(0==b.length)return k&&!f&&k.hide(),void c.apply(null);null==a&&(a=0);var l,m=b[a],n=m.url;m.startWeight&&(h=m.startWeight),m.weight&&(i=m.weight),v[n]?(m.dom=v[n],j()):(k&&!f&&k.progress(.01*h),l=document.createElement("div"),$(l).load(n+"?v="+d,function(){v[n]=l;var a=b.extractClass;a||(a="extract-point");var c=m.dom=$(l).find("."+a)[0];$(c).toggleClass(a,!1),$("#invisible-container").append(c),$(c).waitForImages(function(){if(c.parentNode&&c.parentNode.removeChild(c),k&&!f){var a=(h+i)/100;k.progress(a)}j()},function(a,b){if(k&&!f){var c=(h+a/b*i)/100;k.progress(c)}},!0)}))}k&&!f&&k.show();var h=0,i=100;null!=a?Utility.preloadImages(a.list,g,function(a){k&&!f&&k.progress(a/100)}):g(0)}}(),function(){var a=(window.Utility={},{}),b={};b.log="log",b.warn="warn",b.error="error",b.debug="debug",b.info="info",Utility.setConsoleMethod=function(b,c){console[b]=1==c?a[b]:function(){}},Utility.disableAllConsoleMethods=function(){for(var a in b)this.setConsoleMethod(a,!1)},Utility.enableAllConsoleMethods=function(){for(var a in b)this.setConsoleMethod(a,!0)},function(){if(!window.console){window.console={};for(var c in b)console[b[c]]=function(){}}for(var c in b)a[b[c]]=console[b[c]];window.Array.prototype.indexOf||(window.Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=c<0?Math.ceil(c):Math.floor(c),c<0&&(c+=b);c<b;c++)if(c in this&&this[c]===a)return c;return-1})}();var c={};Utility.analyzeURL=function(a){if(!c[a]){var b=/^((http[s]?|ftp):\/)?\/?([^:\/\s]+)((\/\w+)*\/)([\w\-\.]+[^#?\s]+)(.*)?(#[\w\-]+)?$/;c[a]=a.match(b)}return c[a]},Utility.getPathWithFilename=function(){return window.location.href.replace(window.location.search,"").replace(window.location.hash,"").replace("?","")},Utility.getPath=function(a){a||(a=window.location.href);var b=-1==a.indexOf("?")?a:a.substr(0,a.indexOf("?"));-1!==b.indexOf("#")&&(b=b.substr(0,b.indexOf("#")));var c=b.split("/"),d=c[c.length-1];for(-1!==d.indexOf(".")&&c.pop(),b=c.join("/");b.length&&"/"==b.charAt(b.length-1);)b=b.slice(0,b.length-1);return b+="/"},Utility.getProtocol=function(a){return a||(a=window.location.href),Utility.analyzeURL(a)[2]},Utility.urlParams=function(){var a=decodeURIComponent(window.location.href),b=a.split("?")[1];if(!b)return{};b=b.split("#")[0];for(var c={},d=b.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");c[f[0]]=f[1]}return c}(),Utility.isLocalhost=function(){var a=window.location.toString().split("/")[2];return"localhost"==a||"192"==a.split(".")[0]}(),Utility.preloadImages=function(a,b,c,d){function e(){function g(){null!=i&&(i.collector[i.name]=j),j.onerror=null,j.onload=null,e()}if(c&&c.apply(null,[f/a.length*100<<0]),f>=a.length)return void(b&&b.apply());var h=a[f],i=null;"string"!=typeof h&&(i=h,h=i.url),f++;var j=new Image;j.onload=g,d&&(j.onerror=function(){console.error("load image error: ["+h+"]"),g()}),j.src=h}if(null==d&&(d=!0),!a||0==a.length)return void(b&&b.apply());var f=0;e()},Utility.shuffleArray=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},Utility.isiOS=function(){var a=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;a.length;)if(navigator.platform===a.pop())return!0;return!1}}(),function(){var a=window.PatternSamples={};a.email=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,a.phone=/^(09)[0-9]{8}$/,a.number=/[0-9]/g,a.nonNumber=/[^0-9]/g,a.onlySpace=/^\s*$/,a.localPhone=/^(0)\d{1,3}(-)\d{5,8}$/,a.personId=/^[A-Z]{1}[1-2]{1}[0-9]{8}$/,a.numberAndLetters=/^[a-zA-Z0-9]*$/}(),function(){"use strict";function a(){var a=$(window).width(),c=$(window).height(),d=b.viewport;d.width=a,d.height=c,SceneHandler.currentScene&&SceneHandler.currentScene.resize(),Menu.resize()}var b=window.Main={localSettings:{fb_appid:"141103743143422"},settings:{isLocal:!1,isMobile:!1,useFakeData:!1,debug:!1,fb_appid:"1876517482676293",fbPermissions:[],fbToken:null,fbUid:null,fbState:null,isiOS:!1,isLineBrowser:!1,isEnd:!1,endMessage:"活動已經結束，感謝您的參與"},viewport:{width:0,height:0,ranges:[640],index:-1,changed:!1},hashArray:["/Index","/Participate","/ParticipateForm","/Entries","/VoteForm","/Reviewers","/Rule"],defaultHash:"/Index",init:function(){function c(){SceneHandler.init(Main.hashArray,{defaultHash:b.defaultHash,listeningHashChange:!0,loadingClass:Loading,version:(new Date).getTime(),cbBeforeChange:function(){Menu.close()},cbBeforeStageIn:function(a){var b="/Entries"!=a;$("#scene-container").toggleClass("fix-size-mode",b)},hashChangeTester:function(a){if(!Main.settings.debug){if("/Participate"==a&&!FBHelper._token)return SceneHandler.setHash(Main.defaultHash),null;if("/VoteForm"==a&&(!FBHelper._token||null===VoteForm.getVotingSerial()))return SceneHandler.setHash(Main.defaultHash),null}if("/ParticipateForm"==a&&!(Main.settings.debug||Participate.getIsReadySend()&&FBHelper._token))return SceneHandler.setHash(Main.defaultHash),null;if("/Participate"==a){if(Main.settings.isEnd)return alert(Main.settings.endMessage),SceneHandler.setHash(Main.defaultHash),null;if(!Modernizr.canvas)return alert("您的瀏覽器不支援 html5 canvas, 請使用其他的瀏覽器瀏覽此單元"),SceneHandler.setHash(Main.defaultHash),null;if(b.settings.isLineBrowser)return alert("您的瀏覽器不支援上傳檔案, 請使用其他的瀏覽器瀏覽此單元"),SceneHandler.setHash(Main.defaultHash),null}return a}}),SceneHandler.toFirstHash()}"local.savorks.com"!=window.location.host&&"socket.savorks.com"!=window.location.host||($.extend(b.settings,b.localSettings),Main.settings.isLocal=!0,"1"==Utility.urlParams.usefakedata&&(Main.settings.useFakeData=!0),"1"==Utility.urlParams.debug&&(Main.settings.debug=!0)),b.settings.isLineBrowser=Boolean(navigator.userAgent.match("Line")),b.settings.isiOS=Utility.isiOS(),window._CLICK_=b.settings.isiOS?"touchend":"click",Menu.init(),FBHelper.init(Main.settings.fb_appid,{useRedirectLogin:Main.settings.isiOS||Main.settings.isLineBrowser}),c(),$(window).on("resize",a),a()},loginFB:function(a,b,c){Loading.progress("登入 facebook 中").show(),FBHelper.loginFB(a,b,function(b){Loading.hide(),b&&"unauthorized"==b?alert("您必須登入 facebook 才能參加活動喔"):b?alert(b):(a&&SceneHandler.toHash(a),c&&c.call())})}}}(),function(){var a={},b=!1,c=window.Menu={init:function(){a.container=$("#menu"),a.menuContainer=a.container.find(".menu-base"),a.container.find(".menu-icon").on(_CLICK_,function(){c.open()}),a.menuCover=$("#menu-cover").on(_CLICK_,function(){c.close()}),a.btnIndex=a.menuContainer.find(".button:nth-child(1)").on(_CLICK_,function(){SceneHandler.toHash("/Index"),c.close()}),a.btnParticipate=a.menuContainer.find(".button:nth-child(3)").on(_CLICK_,function(){Main.loginFB("/Participate"),c.close()}),a.btnEntries=a.menuContainer.find(".button:nth-child(5)").on(_CLICK_,function(){SceneHandler.toHash("/Entries"),c.close()}),a.btnReviewer=a.menuContainer.find(".button:nth-child(7)").on(_CLICK_,function(){SceneHandler.toHash("/Reviewers"),c.close()}),a.btnRule=a.menuContainer.find(".button:nth-child(9)").on(_CLICK_,function(){SceneHandler.toHash("/Rule"),c.close()}),a.btnWinners=a.menuContainer.find(".button:nth-child(11)").on(_CLICK_,function(){alert("單元尚未開放, 敬請期待")}),a.btnTShow=a.menuContainer.find(".button:nth-child(13)").on(_CLICK_,function(){alert("單元尚未開放, 敬請期待")})},open:function(){b||(b=!0,c.update())},close:function(){b&&(b=!1,c.update())},update:function(){a.menuContainer.toggleClass("open-mode",b),a.menuCover.toggleClass("active-mode",b)},resize:function(){}}}(),function(){var a={participate:{error:"",serial:"00002"},entries_vote:{error:"",share_url:"./misc/share.jpg"},entries_search:{error:"",data:[{serial:"0088",status:"approved",user_name:"John",num_votes:"31231",thumb_url:"http://xxxx.xx/thumbxxx.jpg",url:"http://xxxx.xx/imagexxx.jpg",description:"bablalalala"}],num_pages:13,page_index:3,page_size:10},"entries_search.serial":{error:"",data:[{serial:"0088",status:"unapproved",school_name:"sc1",class_name:"cn1",user_name:"John",num_votes:"31231",thumb_url:"./images/search-sample.jpg",description:"bablalalala"}],num_pages:1,page_index:0,page_size:1},"entries_search.single":{error:"",data:[{serial:"7354",status:"approved",name:"John",num_votes:"6945",thumb_url:"./images/entries-list-thumb-sample.png",url:"./images/entries-list-thumb-sample.png",description:"bablalalala"}],num_pages:123,page_index:0,page_size:1},index_get_examples:{error:"",examples:["./images/index-t-shirt-demo.png","./images/index-t-shirt-demo.png","./images/index-t-shirt-demo.png","./images/index-t-shirt-demo.png","./images/index-t-shirt-demo.png"]}};window.ApiProxy={callApi:function(b,c,d,e){function f(a){e&&e.call(null,a)}var g="../api/"+b;if(Main.settings.useFakeData&&d){!0===d&&(d=b);var h=a[d];if("entries_search"==d){var i,j,k=c.page_index,l=k*c.page_size,m=23;for(h.page_index=c.page_index,h.num_pages=Math.ceil(m/c.page_size),h.data=[],j=0;j<c.page_size&&(i=l+j,h.data.push({serial:i,school_name:"school name "+i,class_name:" class name "+i,user_name:"user name "+i,num_votes:parseInt(3e3*Math.random()),description:"description "+i,thumb_url:"./images/search-sample.jpg"}),!(i>=m-1));j++);}else"entries_search.single"==d&&(h.page_index=c.page_index,h.data[0].serial=h.page_index);f(h)}else $.ajax({url:g,type:"POST",data:c,dataType:"json"}).done(f).fail(function(){f({error:"無法取得伺服器回應"})})}}}(),function(){function a(a,b){$("#invisible-container").append(a[0].dom),d.container=$("#index"),d.container.find(".btn-participate").on(_CLICK_,function(){Main.loginFB("/Participate")}),d.container.find(".btn-to-entries").on(_CLICK_,function(){SceneHandler.toHash("/Entries")}),f.Examples.init(d.container.find(".examples"),function(){d.container.detach(),b.call()})}function b(a){$("#scene-container").append(d.container),f.resize();var b=new TimelineMax;b.set(d.container,{autoAlpha:0}),b.to(d.container,.4,{autoAlpha:1}),b.add(function(){a.apply()})}function c(a){var b=new TimelineMax;b.to(d.container,.4,{autoAlpha:0}),b.add(function(){d.container.detach(),a.apply()})}var d={},e=!1,f=window.Index={stageIn:function(c,d){function f(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function g(b){var c=[{url:"_index.html",startWeight:0,weight:40,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c,function(){e=!0,Loading.hide(),b.apply(null)})},!0,!1)}e?f():g(f)},stageOut:function(a,b){c(b)},resize:function(){}}}(),function(){var a,b,c=60,d=40,e=0,f=0,g=[],h=!0;window.Index.Examples={init:function(i,j){function k(){h=!1,m(0,0,!0)}function l(b){function e(){if(h>=a.length)return void b.call();var i=new Image;i.onload=function(){h++,g.push(i);var a=parseInt(c+d*(h/f))/100;Loading.progress(a),e()},i.src=a[h]}var h=0;e()}function m(a,c,d){if(void 0===c&&(c=0),!h&&(d||a!==e)){h=!0,e=a;var f=b;b=g[e];var i=100*c;f&&TweenMax.to(f,.5,{opacity:0,left:-i,onComplete:function(){$(f).detach()}}),n.append(b);var j=new TimelineMax;j.set(b,{opacity:0,left:i}),j.to(b,.5,{opacity:1,left:0}),j.add(function(){h=!1})}}var n=i.find(".user-example");i.find(".arrow-prev").on(_CLICK_,function(){if(!h){var a=e-1;a<0&&(a=f-1),m(a,-1)}}),i.find(".arrow-next").on(_CLICK_,function(){if(!h){var a=e+1;a>=f&&(a=0),m(a,1)}}),ApiProxy.callApi("index_get_examples",{},!0,function(b){b.error?alert(b.error):(a=b.examples,0==a.length&&(a=["./images/index-t-shirt-demo.png"]),f=a.length,l(function(){k(),j.call()}))})}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),h.container=$("#participate"),c(),d(),p.DialogIsReady.init($("#dialog-is-ready")),h.btnSend=h.container.find(".btn-send").on(_CLICK_,function(){l?m?n?SceneHandler.toHash("/ParticipateForm"):alert("您必須同意我們的活動辦法"):alert("請輸入 20 個字元以上的作品說明"):alert("請先選擇欲上傳的圖片")}),h.ruleCheckbox=h.container.find("#upload-checkbox").on("change",function(){b()}),b(),h.container.detach()}function b(){var a=p.getDescriptionInput();l=!!p.getImage(),m=a!=i&&a.length>=20,n=h.ruleCheckbox[0].checked;var b=l&&m&&n;h.btnSend.toggleClass("disactivated",!b)}function c(){h.textArea=h.container.find(".description"),h.textArea.val(i),h.textArea.on("blur",function(){var a=h.textArea.val();PatternSamples.onlySpace.test(a)&&h.textArea.val(i)}).on("focus",function(){h.textArea.val()===i&&h.textArea.val("")}).on("input propertychange",function(){b()})}function d(){function a(a,b){if(a.files&&a.files[0]){var d=new FileReader;d.onload=function(a){c(a.target.result,b)},d.readAsDataURL(a.files[0])}}function c(a,b){e(),k.image=document.createElement("img"),k.image.onload=function(){if(k.image.width!=o.raw.w||k.image.height!=o.raw.h){var a="您所上傳的圖片尺寸 ( "+k.image.width+"px X "+k.image.height+"px ) 和我們的作品規格 ( "+o.raw.w+"px X "+o.raw.h+"px ) 不同\n\n將自動裁切或縮放, 請預覽圖片確定內容是否正確.";alert(a)}var c=p.getPreviewCanvas();h.previewContainer.append(c),b&&b.call()},k.image.src=a}h.previewContainer=h.container.find(".preview");var d=h.container.find(".image-input")[0];h.btnSelectImage=h.container.find(".btn-upload").on("click",function(){d.value=null,d.click()}),$(d).on("change",function(){Loading.progress("empty").show(),a(d,function(){b(),Loading.hide()})})}function e(){k.image&&($(k.image).detach(),k.image=null),k.rawCanvas&&($(k.rawCanvas).detach(),k.rawCanvas=null),k.previewCanvas&&($(k.previewCanvas).detach(),k.previewCanvas=null),k.thumbCanvas&&($(k.thumbCanvas).detach(),k.thumbCanvas=null)}function f(a){$("#scene-container").append(h.container),p.resize();var b=new TimelineMax;b.set(h.container,{autoAlpha:0}),b.to(h.container,.4,{autoAlpha:1}),b.add(function(){p.DialogIsReady.show(),a.apply()})}function g(a){p.DialogIsReady.hide();var b=new TimelineMax;b.to(h.container,.4,{autoAlpha:0}),b.add(function(){h.container.detach(),a.apply()})}var h={},i="請輸入作品說明(至少 20 字元, 最多 120 字元)",j=!1,k={},l=!1,m=!1,n=!1,o={raw:{w:7086,h:3543},preview:{w:456,h:228},thumb:{w:456,h:228}},p=window.Participate={stageIn:function(b,c){function d(a){a&&b.cbContentLoaded&&b.cbContentLoaded.call(),f(c)}function e(b){var c=[{url:"_participate.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c),j=!0,b.apply(null)},0)}j?d():e(d)},stageOut:function(a,b){g(b)},resize:function(){},getDescriptionInput:function(){var a=h.textArea.val();return a==h.textArea.defaultText&&(a=""),a},getRawCanvas:function(){return p.getCanvas("raw")},getPreviewCanvas:function(){return p.getCanvas("preview")},getThumbCanvas:function(){return p.getCanvas("thumb")},getImage:function(){return k.image},getCanvas:function(a){var b=a+"Canvas";if(!k[b]){if(!k.image)return null;var c=o[a];k[b]=Helper.imageToCanvas(k.image,c.w,c.h)}return k[b]},getIsInit:function(){return j},getIsReadySend:function(){return Boolean(l&&n&&m)},reset:function(){h.textArea.val(i),e()}}}(),function(){var a,b,c,d=!0,e=window.Participate.DialogIsReady={init:function(c){a=c,a.find(".btn-close").on(_CLICK_,function(){e.hide()}),a.find(".btn-yes").on(_CLICK_,function(){e.hide()}),a.find(".btn-no").on(_CLICK_,function(){window.open("http://uniform.wingzero.tw/generators/clothes","_blank"),e.hide()}),b=a.find(".content"),a.detach()},show:function(){if(d){d=!1,c&&c.kill();var e=c=new TimelineMax;e.set(a,{autoAlpha:0}),e.set(b,{autoAlpha:0,y:50}),e.to(a,.3,{autoAlpha:1}),e.to(b,.3,{autoAlpha:1,y:0}),$("body").append(a)}},hide:function(){if(!d){d=!0,c&&c.kill();var e=c=new TimelineMax;e.to(b,.3,{autoAlpha:0,y:-50}),e.to(a,.3,{autoAlpha:0}),e.add(function(){a.detach()})}}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),f.container=$("#participate-form"),f.btnSend=f.container.find(".btn-send").on(_CLICK_,function(){d()}),f.fields={schoolName:f.container.find(".field-school-name"),className:f.container.find(".field-class-name"),userName:f.container.find(".field-user-name"),phone:f.container.find(".field-phone"),email:f.container.find(".field-email"),ruleCheck:f.container.find("#participate-form-checkbox")},h.Success.init($("#participate-form-success")),f.container.detach()}function b(a){$("#scene-container").append(f.container),h.resize();var b=new TimelineMax;b.set(f.container,{autoAlpha:0}),b.to(f.container,.4,{autoAlpha:1}),b.add(function(){a.apply()})}function c(a){h.Success.hide();var b=new TimelineMax;b.to(f.container,.4,{autoAlpha:0}),b.add(function(){f.container.detach(),a.apply()})}function d(){var a=e();if(a){var b,c;b=Participate.getRawCanvas(),b?(c=b.toDataURL("image/jpeg",.95).replace(/^data:image\/jpeg;base64,/,""),a.image_data=c,a.description=Participate.getDescriptionInput(),Loading.progress("資料傳輸中 ... 請稍候").show(),ApiProxy.callApi("participate",a,!0,function(a){a.error?alert(a.error):(h.Success.setShareEntrySerial(a.serial),h.Success.show()),Loading.hide()})):alert("lack image data")}}function e(){var a,b={};return f.fields.ruleCheck.prop("checked")?(a=f.fields.schoolName[0],PatternSamples.onlySpace.test(a.value)?(alert("請輸入學校名稱"),void a.focus()):(b.school_name=a.value,a=f.fields.className[0],PatternSamples.onlySpace.test(a.value)?(alert("請輸入您的班級(系級)"),void a.focus()):(b.class_name=a.value,a=f.fields.userName[0],PatternSamples.onlySpace.test(a.value)?(alert("請輸入您的名稱"),void a.focus()):(b.user_name=a.value,a=f.fields.phone[0],PatternSamples.phone.test(a.value)?(b.phone=a.value,a=f.fields.email[0],PatternSamples.email.test(a.value)?(b.email=a.value,b.fb_uid=FBHelper._uid,b.fb_token=FBHelper._token,b):(alert("請輸入您的電子郵件信箱"),void a.focus())):(alert("請輸入正確的手機號碼"),void a.focus()))))):void alert('您必須同意 "授權主辦單位使用本人個人資料" 才能參加活動')}var f={},g=!1,h=window.ParticipateForm={stageIn:function(c,d){function e(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function f(b){var c=[{url:"_participate_form.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c),g=!0,b.apply(null)},0)}g?e():f(e)},stageOut:function(a,b){c(b)},resize:function(){}}}(),function(){var a,b,c,d,e=!0,f=window.ParticipateForm.Success={init:function(c){a=c,a.find(".btn-close").on(_CLICK_,function(){f.hide(),SceneHandler.toHash("/Entries")}),a.find(".btn-share").on("click",function(){FB.ui({method:"feed",display:"iframe",link:Utility.getPath()+"?serial="+d},function(a){a&&a.post_id&&(f.hide(),SceneHandler.toHash("/Entries"))})}),b=a.find(".content"),a.detach()},setShareEntrySerial:function(a){d=a},show:function(){if(e){e=!1,c&&c.kill();var d=c=new TimelineMax;d.set(a,{autoAlpha:0}),d.set(b,{autoAlpha:0,y:50}),d.to(a,.3,{autoAlpha:1}),d.to(b,.3,{autoAlpha:1,y:0}),$("body").append(a)}},hide:function(){if(!e){e=!0,c&&c.kill();var d=c=new TimelineMax;d.to(b,.3,{autoAlpha:0,y:-50}),d.to(a,.3,{autoAlpha:0}),d.add(function(){a.detach()})}}}}(),function(){function a(a){$("#scene-container").append(o.container),u.resize();var b=new TimelineMax;b.set(o.container,{autoAlpha:0}),b.to(o.container,.4,{autoAlpha:1}),b.add(function(){d(),s||(s=!0,o.keywordInput.val(""),k="",g(0,!0)),a.apply()})}function b(a){e();var b=new TimelineMax;b.to(o.container,.4,{autoAlpha:0}),b.add(function(){o.container.detach(),a.apply()})}function c(a){$("#invisible-container").append(a[0].dom),o.container=$("#entries"),u.Creator.init(o.container.find(".entries-container")),u.DialogReviewing.init($("#dialog-reviewing")),u.DialogUnapproved.init($("#dialog-unapproved")),o.keywordInput=o.container.find(".search-input").on("keyup",function(a){13==a.keyCode&&o.btnSearchName.click()}),o.btnSearchName=o.container.find(".btn-search-name").on("click",function(){if(!l){var a=o.keywordInput.val();PatternSamples.onlySpace.test(a)||(k=a,g(0,!0))}}),o.btnSearchSerial=o.container.find(".btn-search-serial").on("click",function(){if(!l){var a=parseInt(o.keywordInput.val());isNaN(a)?alert("請輸入數字編碼"):(k=a,o.keywordInput.val(""),g(0,!0,null,!0))}}),o.btnSortByDate=o.container.find(".tab-latest").on("click",function(){l||h("date")}),o.btnSortByRank=o.container.find(".tab-popular").on("click",function(){l||h("votes")}),o.bottomBleed=o.container.find(".bleed"),o.container.detach()}function d(){p=!0,$(window).on("scroll",f)}function e(){p=!1,$(window).unbind("scroll",f)}function f(){if(!l&&p){if(o.bottomBleed[0].getBoundingClientRect().bottom-40<Main.viewport.height&&n){var a=parseInt(n.num_pages),b=parseInt(n.page_index),c=b+1;c<a&&g(c,!1,null,!1)}}}function g(a,b,c,d){if(p&&!l){l=!0,b&&(u.Creator.clear(),n=null),i();var e=k,f={keyword:k,search_type:d?"serial":"user_name",status:d?"":"approved",sort_type:r,page_index:a,page_size:q};d?ApiProxy.callApi("entries_search",f,"entries_search.serial",function(a){if(a.error)alert(a.error);else if(n=a,0==a.data.length)alert("很抱歉, 作品編號 ["+e+"] 並不存在");else{var b=a.data[0];"approved"==b.status?u.Creator.insertEntries(a.data,!0):"reviewing"==b.status?Entries.DialogReviewing.show():"unapproved"==b.status&&Entries.DialogUnapproved.show()}j(),l=!1}):(m=f,ApiProxy.callApi("entries_search",f,"entries_search",function(a){a.error?alert(a.error):(n=a,u.Creator.insertEntries(a.data),l=!1),j()}))}}function h(a){a!=r&&(l||(r=a,"date"==r?(o.btnSortByDate.toggleClass("active-mode",!0),o.btnSortByRank.toggleClass("active-mode",!1)):(o.btnSortByDate.toggleClass("active-mode",!1),o.btnSortByRank.toggleClass("active-mode",!0)),g(0,!0)))}function i(){o.bottomBleed.toggleClass("active-mode",!0)}function j(){o.bottomBleed.toggleClass("active-mode",!1)}var k,l,m,n,o={},p=!1,q=10,r="date",s=!1,t=!1,u=window.Entries={stageIn:function(b,d){function e(c){c&&b.cbContentLoaded&&b.cbContentLoaded.call(),a(d)}function f(a){var b=[{url:"_entries.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,b,function(){c(b),t=!0,a.apply(null)},0)}t?e():f(e)},stageOut:function(a,c){b(c)},resize:function(){}}}(),function(){var a,b,c=[],d=window.Entries.Creator={init:function(c){b=c,a=c.find(".entry").detach()},insertEntries:function(a,b){var c;for(c=0;c<a.length;c++)d.createOne(a[c],b)},createOne:function(d,e){var f=new Entries.Entry(a,b,e);f.applyData(d),c.push(f)},clear:function(){var a,b;for(a=0;a<c.length;a++)b=c[a],b.destroy();c=[]}}}(),function(){(window.Entries.Entry=function(a,b,c){function d(){e._isOpen=!e._isOpen,e.$dom.toggleClass("open-mode",e._isOpen)}var e=this,f=e.$dom=a.clone();b.append(f),f.find(".btn-switch").on(_CLICK_,d),c&&d()}).prototype={_isOpen:!1,$dom:null,$divLine:null,$description:null,applyData:function(a){this.$dom.find(".num-votes").text(a.num_votes),this.$dom.find(".school-name").text(a.school_name),this.$dom.find(".class-name").text(a.class_name),this.$dom.find(".user-name").text(a.user_name),this.$dom.find(".description").text(a.description),this.$dom.find(".btn-vote").on(_CLICK_,function(){Main.loginFB(null,null,function(){VoteForm.setVotingSerial(a.serial),SceneHandler.toHash("/VoteForm")})});var b=this,c=new Image;c.onload=function(){b.$dom.find(".thumb").append(c),TweenMax.from(c,.5,{autoAlpha:0})},c.src=a.thumb_url},destroy:function(){this.$dom.detach()}}}(),function(){var a,b,c,d,e=!0,f=window.Entries.DialogReviewing={init:function(c){a=c,a.find(".btn-close").on(_CLICK_,function(){f.hide()}),a.find(".btn-continue").on("click",function(){f.hide()}),b=a.find(".content"),a.detach()},setShareEntrySerial:function(a){d=a},show:function(){if(e){e=!1,c&&c.kill();var d=c=new TimelineMax;d.set(a,{autoAlpha:0}),d.set(b,{autoAlpha:0,y:50}),d.to(a,.3,{autoAlpha:1}),d.to(b,.3,{autoAlpha:1,y:0}),$("body").append(a)}},hide:function(){if(!e){e=!0,c&&c.kill();var d=c=new TimelineMax;d.to(b,.3,{autoAlpha:0,y:-50}),d.to(a,.3,{autoAlpha:0}),d.add(function(){a.detach()})}}}}(),function(){var a,b,c,d,e=!0,f=window.Entries.DialogUnapproved={init:function(c){a=c,a.find(".btn-close").on(_CLICK_,function(){f.hide()}),a.find(".btn-continue").on("click",function(){f.hide()}),b=a.find(".content"),a.detach()},setShareEntrySerial:function(a){d=a},show:function(){if(e){e=!1,c&&c.kill();var d=c=new TimelineMax;d.set(a,{autoAlpha:0}),d.set(b,{autoAlpha:0,y:50}),d.to(a,.3,{autoAlpha:1}),d.to(b,.3,{autoAlpha:1,y:0}),$("body").append(a)}},hide:function(){if(!e){e=!0,c&&c.kill();var d=c=new TimelineMax;d.to(b,.3,{autoAlpha:0,y:-50}),d.to(a,.3,{autoAlpha:0}),d.add(function(){a.detach()})}}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),f.container=$("#vote-form"),f.btnSend=f.container.find(".btn-send").on(_CLICK_,function(){e()}),f.fields={userName:f.container.find(".field-user-name"),phone:f.container.find(".field-phone"),email:f.container.find(".field-email"),ruleCheck:f.container.find("#participate-form-checkbox")},i.Success.init($("#vote-form-success")),i.ShareSuccess.init($("#vote-form-share-success")),f.container.detach()}function b(a){$("#scene-container").append(f.container),i.resize();var b=new TimelineMax;b.set(f.container,{autoAlpha:0}),b.to(f.container,.4,{autoAlpha:1}),b.add(function(){a.apply()})}function c(a){i.Success.hide();var b=new TimelineMax;b.to(f.container,.4,{autoAlpha:0}),b.add(function(){f.container.detach(),a.apply()})}function d(){g=null}function e(){var a={};a&&(null===g?alert("lack voting serial"):(a.serial=g,Loading.progress("資料傳輸中 ... 請稍候").show(),ApiProxy.callApi("entries_vote",a,!0,function(a){a.error?alert(a.error):(VoteForm.Success.setShareEntrySerial(g),VoteForm.Success.setShareImageUrl(a.share_url),d(),VoteForm.Success.show()),Loading.hide()})))}var f={},g=null,h=!1,i=window.VoteForm={stageIn:function(c,d){function e(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function f(b){var c=[{url:"_vote_form.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c),h=!0,b.apply(null)},0)}h?e():f(e)},stageOut:function(a,b){c(b)},setVotingSerial:function(a){g=a},getVotingSerial:function(){return g},resize:function(){}}}(),function(){var a,b,c,d,e,f=!0,g=window.VoteForm.Success={init:function(c){a=c,a.find(".btn-close").on(_CLICK_,function(){g.hide(),SceneHandler.toHash("/Entries")}),a.find(".btn-share").on("click",function(){FB.ui({method:"feed",display:"iframe",link:Utility.getPath()+"?serial="+d,title:"vote success share title",description:"vote success share text",picture:e+"?v="+(new Date).getTime()},function(a){a&&a.post_id&&(g.hide(),VoteForm.ShareSuccess.show())})}),b=a.find(".content"),a.detach()},setShareEntrySerial:function(a){d=a},setShareImageUrl:function(a){e=a},show:function(){if(f){f=!1,c&&c.kill();var d=c=new TimelineMax;d.set(a,{autoAlpha:0}),d.set(b,{autoAlpha:0,y:50}),d.to(a,.3,{autoAlpha:1}),d.to(b,.3,{autoAlpha:1,y:0}),$("body").append(a)}},hide:function(){if(!f){f=!0,c&&c.kill();var d=c=new TimelineMax;d.to(b,.3,{autoAlpha:0,y:-50}),d.to(a,.3,{autoAlpha:0}),d.add(function(){a.detach()})}}}}(),function(){var a,b,c,d=!0,e=window.VoteForm.ShareSuccess={init:function(c){a=c,a.find(".btn-close").on(_CLICK_,function(){e.hide(),SceneHandler.toHash("/Entries")}),a.find(".btn-participate").on("click",function(){e.hide(),SceneHandler.toHash("/Participate")}),a.find(".btn-entries").on("click",function(){e.hide(),SceneHandler.toHash("/Entries")}),b=a.find(".content"),a.detach()},show:function(){if(d){d=!1,c&&c.kill();var e=c=new TimelineMax;e.set(a,{autoAlpha:0}),e.set(b,{autoAlpha:0,y:50}),e.to(a,.3,{autoAlpha:1}),e.to(b,.3,{autoAlpha:1,y:0}),$("body").append(a)}},hide:function(){if(!d){d=!0,c&&c.kill();var e=c=new TimelineMax;e.to(b,.3,{autoAlpha:0,y:-50}),e.to(a,.3,{autoAlpha:0}),e.add(function(){a.detach()})}}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),d.container=$("#reviewers"),d.container.detach()}function b(a){$("#scene-container").append(d.container),f.resize();var b=new TimelineMax;b.set(d.container,{autoAlpha:0}),b.to(d.container,.4,{autoAlpha:1}),b.add(function(){a.apply()})}function c(a){var b=new TimelineMax;b.to(d.container,.4,{autoAlpha:0}),b.add(function(){d.container.detach(),a.apply()})}var d={},e=!1,f=window.Reviewers={stageIn:function(c,d){function f(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function g(b){var c=[{url:"_reviewers.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c),e=!0,b.apply(null)},0)}e?f():g(f)},stageOut:function(a,b){c(b)},resize:function(){}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),d.container=$("#rule"),d.container.detach()}function b(a){$("#scene-container").append(d.container),f.resize();var b=new TimelineMax;b.set(d.container,{autoAlpha:0}),b.to(d.container,.4,{autoAlpha:1}),b.add(function(){a.apply()})}function c(a){var b=new TimelineMax;b.to(d.container,.4,{autoAlpha:0}),b.add(function(){d.container.detach(),a.apply()})}var d={},e=!1,f=window.Rule={stageIn:function(c,d){function f(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function g(b){var c=[{url:"_rule.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c),e=!0,b.apply(null)},0)}e?f():g(f)},stageOut:function(a,b){c(b)},resize:function(){}}}();